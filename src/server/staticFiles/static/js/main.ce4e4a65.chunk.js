(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{101:function(e,t,a){},102:function(e,t,a){},103:function(e,t,a){},104:function(e,t,a){},105:function(e,t,a){},106:function(e,t,a){},107:function(e,t,a){},108:function(e,t,a){},109:function(e,t,a){"use strict";a.r(t);var n=a(0),c=a.n(n),r=a(42),o=a.n(r),l=a(7),s=a(1),u=(a(50),a(3)),i=a.n(u),m=a(5),f=a(43),d=a.n(f).a.create({baseURL:"".concat("","/api"),withCredentials:!0,headers:{"Access-Control-Allow-Credentials":!0}}),h=function(e){var t=e.token,a=e.setToken,r=function(){var e=Object(m.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.get("/auth/logout");case 2:a(null);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),o=Object(n.useCallback)(Object(m.a)(i.a.mark((function e(){var t,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d.get("/auth/test");case 3:t=e.sent,n=t.status>=200||t.status<=299,a(n?t.data:null),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),a(null);case 11:case"end":return e.stop()}}),e,null,[[0,8]])}))),[a]);return Object(n.useEffect)((function(){o()}),[o]),t?c.a.createElement("p",{onClick:r,className:"login-btn"},"Log out"):c.a.createElement("a",{href:"".concat("","/api/auth/google"),className:"login-btn"},"Log in")},p=function(e){var t=e.token,a=e.setToken;return c.a.createElement("div",{className:"header-container"},c.a.createElement("h1",{className:"logo"},"CHAT-APP"),c.a.createElement(h,{token:t,setToken:a}))},b=a(44),E=a.n(b);function v(e){var t=e.setModalComponent;return c.a.createElement("button",{className:"button",style:{marginTop:"1rem"},onClick:function(){return t("CreateRoom")}},"New Room")}a(101);function g(e){var t=e.data,a=e.selectChat,n=e.selectedChat;return c.a.createElement("div",{className:"chat-item ".concat(n&&n._id===t._id?"chat-item-active":""),onClick:a},c.a.createElement("h3",null,t.roomName),t.lastMessage&&c.a.createElement("p",null,t.lastMessage.author,": ",t.lastMessage.content))}a(102);function k(e){var t=e.availableChats,a=e.setModalComponent,n=e.setSelectedChat,r=e.selectedChat;return c.a.createElement("div",{className:"chat-list-container"},c.a.createElement("div",{className:"chat-list-bg"},c.a.createElement("h2",{className:"chat-list-title"},"Rooms:"),t.map((function(e){return c.a.createElement(g,{key:e._id,data:e,selectedChat:r,selectChat:function(){return n(e)}})})),c.a.createElement(v,{setModalComponent:a})))}function O(){return c.a.createElement("div",{style:{margin:"2rem"}},"Select a chat room to view its messages!")}a(103);function j(e){var t=e.chat,a=e.socket,r=Object(n.useState)([]),o=Object(s.a)(r,2),u=o[0],f=o[1],h=Object(n.useState)(""),p=Object(s.a)(h,2),b=p[0],E=p[1],v=Object(n.useState)(""),g=Object(s.a)(v,2),k=g[0],j=g[1],C=Object(n.useCallback)(Object(m.a)(i.a.mark((function e(){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.get("/message/".concat(t._id));case 2:(a=e.sent).status>=200&&a.status<=299&&f(a.data);case 4:case"end":return e.stop()}}),e)}))),[f,t]),w=function(){var e=Object(m.a)(i.a.mark((function e(){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==b){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,d.post("/message",{content:b,chatroom:t._id});case 4:(a=e.sent).status>=200&&a.status<=299&&E("");case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),N=function(e){e.target.value.length>255?j("Max message length reached"):(E(e.target.value),j(""))};Object(n.useEffect)((function(){null!=t&&C()}),[t,C]),Object(n.useEffect)((function(){if(a)return a.on("new message",(function(e){e.chatRoom===t._id&&f((function(t){return[].concat(Object(l.a)(t),[e])}))})),function(){return a.off("new message")}}),[a,t]);return c.a.createElement("div",{className:"chat-room-container"},t?c.a.createElement(c.a.Fragment,null,c.a.createElement("h1",{className:"room-name"},t.roomName),c.a.createElement("div",{className:"messages-container"},u.map((function(e){return c.a.createElement("div",{key:e._id},c.a.createElement("p",null,e.author.name.first," ",e.author.name.last,":"," ",e.content))}))),c.a.createElement("div",{className:"message-input"},c.a.createElement("input",{value:b,onKeyDown:function(e){return"Enter"===e.key&&w()},onChange:N,placeholder:"your message",style:{flexGrow:"1",marginRight:"3px"}}),c.a.createElement("button",{onClick:function(){return w()}},"Submit")),k&&c.a.createElement("p",{style:{color:"red"}},k)):c.a.createElement(O,null))}a(104);function C(e){var t=e.modalComponent,a=e.setModalComponent,n=e.children;if(""===t)return null;var r=function(){return a("")};return c.a.createElement("div",{className:"modal-bg",onClick:r},c.a.createElement("div",{className:"modal-container"},c.a.createElement("div",{onClick:function(e){return e.stopPropagation()},className:"modal"},c.a.createElement("div",{className:"modal-header"},c.a.createElement("p",{style:{color:"white"}},"Create room"),c.a.createElement("button",{className:"modal-close-button",onClick:r},"X")),n)))}a(105);function w(e){var t=e.createNewRoom,a=Object(n.useState)(""),r=Object(s.a)(a,2),o=r[0],u=r[1],f=Object(n.useState)(""),h=Object(s.a)(f,2),p=h[0],b=h[1],E=Object(n.useState)([]),v=Object(s.a)(E,2),g=v[0],k=v[1],O=Object(n.useState)(""),j=Object(s.a)(O,2),C=j[0],w=j[1],N=function(){var e=Object(m.a)(i.a.mark((function e(){var t,a,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1===g.map((function(e){return e.email})).indexOf(p)){e.next=3;break}return w("User is already in participants list"),e.abrupt("return");case 3:return e.prev=3,e.next=6,d.post("/user",{email:p});case 6:t=e.sent,a=t.data,w(""),b(""),k((function(e){return[].concat(Object(l.a)(e),[a])})),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(3),n=e.t0.response,w(n.data);case 17:case"end":return e.stop()}}),e,null,[[3,13]])})));return function(){return e.apply(this,arguments)}}();return c.a.createElement("div",{className:"form-container"},c.a.createElement("div",{className:"input-row"},c.a.createElement("p",{className:"label"},"Room name:"),c.a.createElement("input",{className:"input",type:"text",placeholder:"New room name",value:o,onChange:function(e){e.target.value.length>20?w("Max room name length reached"):(u(e.target.value),w(""))}})),c.a.createElement("div",{className:"input-row"},c.a.createElement("p",{className:"label"},"Email:"),c.a.createElement("div",{style:{display:"flex"}},c.a.createElement("input",{className:"input",type:"email",placeholder:"Enter friend's email",value:p,onChange:function(e){return b(e.target.value)}}),c.a.createElement("button",{className:"button",onClick:N},"Add!"))),g.map((function(e){return c.a.createElement("p",{key:e._id},e.name.first," ",e.name.last)})),C&&c.a.createElement("p",{style:{color:"red"}},C),c.a.createElement("button",{className:"button",disabled:0===o.length,onClick:function(){return t(o,g.map((function(e){return e._id})))}},"Create room!"))}a(106);function N(e){var t=e.token,a=e.setToken;return c.a.createElement("div",{className:"not-logged-in-container"},c.a.createElement("p",null,"Please log in with google to use this app"),c.a.createElement(h,{token:t,setToken:a}))}a(107);function y(){var e=Object(n.useState)(null),t=Object(s.a)(e,2),a=t[0],r=t[1],o=Object(n.useState)([]),u=Object(s.a)(o,2),i=u[0],m=u[1],f=Object(n.useState)(null),h=Object(s.a)(f,2),b=h[0],v=h[1],g=Object(n.useState)(""),O=Object(s.a)(g,2),y=O[0],x=O[1],S=Object(n.useState)(null),M=Object(s.a)(S,2),R=M[0],T=M[1],_=function(e,t){d.post("/chatroom",{roomName:e,participants:t})},A=Object(n.useMemo)((function(){return function(){d.get("/chatroom").then((function(e){return m(e.data)})).catch(console.log)}}),[]);Object(n.useEffect)((function(){if(a){var e=E()("");return e.on("requestAuth",(function(){e.emit("authenticate",a)})),e.on("authFailed",(function(){console.log("auth failed")})),e.on("authSuccess",(function(){console.log("auth success")})),e.on("new room",(function(e){m((function(t){return[].concat(Object(l.a)(t),[e])}))})),T(e),function(){return e.disconnect()}}}),[a]),Object(n.useEffect)((function(){a&&A()}),[a,A]);return c.a.createElement(c.a.Fragment,null,c.a.createElement(C,{modalComponent:y,setModalComponent:x},function(){switch(y){case"CreateRoom":return c.a.createElement(w,{createNewRoom:_});default:return null}}()),c.a.createElement("div",null,c.a.createElement(p,{token:a,setToken:r}),a?c.a.createElement("div",{style:{display:"flex",height:"85vh"}},c.a.createElement(k,{availableChats:i,setModalComponent:x,setSelectedChat:v,selectedChat:b}),c.a.createElement(j,{socket:R,chat:b})):c.a.createElement(N,{token:a,setToken:r})))}a(108),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(y,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},45:function(e,t,a){e.exports=a(109)},50:function(e,t,a){},98:function(e,t){}},[[45,1,2]]]);
//# sourceMappingURL=main.ce4e4a65.chunk.js.map